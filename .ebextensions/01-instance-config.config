option_settings:
  # Use smallest instance type
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.nano
  # Keep it load balanced for WebSocket support but minimize instances
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 1
    Cooldown: 600
  aws:elasticbeanstalk:environment:
    EnvironmentType: LoadBalanced
  # WebSocket process configuration
  aws:elasticbeanstalk:environment:process:websocket:
    Port: 5000
    Protocol: HTTP
    StickinessEnabled: true
    StickinessLBCookieDuration: 3600
  # Load balancer listener rule for WebSocket paths
  aws:elbv2:listenerrule:ws:
    PathPatterns: /heroes,/remoteControl
    Priority: 1
    Process: websocket
  # Disable rolling updates to avoid extra instances during deployment
  aws:autoscaling:updatepolicy:rollingupdate:
    RollingUpdateEnabled: false
    MinInstancesInService: 0
